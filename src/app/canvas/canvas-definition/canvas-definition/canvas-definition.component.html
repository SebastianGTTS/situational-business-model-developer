<div class="nav-scroller bg-white shadow-sm">
  <nav class="nav nav-underline">
    <a class="nav-link" [routerLink]="['/', 'canvas', 'definitions']">Canvas Definitions</a>
    <a *ngIf="canvasDefinition" class="nav-link active" [routerLink]="[]">{{canvasDefinition.name}}</a>
  </nav>
</div>

<main *ngIf="canvasDefinition" role="main" class="container">

  <div class="my-3 p-3 bg-white rounded shadow-sm">
    <h6 class="border-bottom border-gray pb-2">Canvas Definition</h6>
    <form [formGroup]="rowForm" (ngSubmit)="submitRowForm()">
      <button type="button" class="btn btn-block btn-sm btn-primary mb-3" (click)="addRow()">Add row</button>
      <ul formArrayName="rows" class="list-group">
        <li
          class="list-group-item"
          *ngFor="let row of rowsFormArray.controls; let rowIndex = index"
          [formArrayName]="rowIndex.toString()">
          <div class="d-flex">
            <b>{{rowIndex + 1}}. Row</b>
            <button type="button" class="btn btn-xs btn-primary ml-auto" (click)="addBlock(rowIndex)">Add Block</button>
            <button type="button" class="btn btn-xs btn-secondary ml-3" (click)="addRow(rowIndex)">Add Row above
            </button>
            <button type="button" class="btn btn-xs btn-dark ml-3" (click)="removeRow(rowIndex)">Remove</button>
          </div>
          <div *ngIf="asFormArray(row).length > 0" class="form-group mt-2">
            <div
              class="form-row"
              *ngFor="let block of asFormArray(row).controls; let blockIndex = index"
              [formGroupName]="blockIndex.toString()">
              <div class="form-group col-md-3">
                <label for="selectSpacer{{blockIndex}}">Element or Spacer</label>
                <select id="selectSpacer{{blockIndex}}" class="form-control" formControlName="isSpacer"
                        (change)="spacerChange(rowIndex, blockIndex)">
                  <option [ngValue]="false">Element</option>
                  <option [ngValue]="true">Spacer</option>
                </select>
              </div>
              <div class="col-md-3" *ngIf="block.value.isSpacer"></div>
              <div class="form-group col-md-3" *ngIf="!block.value.isSpacer">
                <label for="inputName{{blockIndex}}">Name</label>
                <input class="form-control" id="inputName{{blockIndex}}" formControlName="name">
              </div>
              <div class="form-group col-md-3">
                <label for="inputRowspan{{blockIndex}}">Rowspan</label>
                <input type="number" [min]="1" class="form-control" id="inputRowspan{{blockIndex}}"
                       formControlName="rowspan">
              </div>
              <div class="form-group col-md-3">
                <label for="inputColspan{{blockIndex}}">Colspan</label>
                <div class="input-group">
                  <input type="number" [min]="1" class="form-control" id="inputColspan{{blockIndex}}"
                         formControlName="colspan">
                  <div class="input-group-append">
                    <button type="button" class="btn btn-dark form-control" (click)="removeBlock(rowIndex, blockIndex)">
                      Remove
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </li>
      </ul>
      <button type="submit" class="btn btn-block btn-sm btn-dark mt-3" [disabled]="!rowForm.valid">Update</button>
    </form>
  </div>

  <div class="my-3 p-3 bg-white rounded shadow-sm">
    <h6 class="border-bottom border-gray pb-2">Canvas Definition Overview</h6>
    <table class="table table-bordered" style="table-layout: fixed">
      <tbody>
      <tr *ngFor="let row of canvas">
        <ng-container *ngFor="let cell of row">
          <td *ngIf="!cell.isSpacer" [colSpan]="cell.colspan" [rowSpan]="cell.rowspan"><b>{{cell.name}}</b></td>
          <td *ngIf="cell.isSpacer" [colSpan]="cell.colspan" [rowSpan]="cell.rowspan"></td>
        </ng-container>
      </tr>
      </tbody>
    </table>
  </div>

  <div class="my-3 p-3 bg-white rounded shadow-sm">
    <h6 class="border-bottom border-gray pb-2">Edit Canvas Definition</h6>
    <div class="text-muted pt-3">
      <form [formGroup]="editCanvasDefinitionForm" (ngSubmit)="updateName()">
        <div class="form-group form-row">
          <label for="name" class="col-sm-4 col-form-label">Name</label>
          <div class="col-sm-8">
            <input
              type="text"
              formControlName="name"
              class="form-control"
              [class.is-invalid]="nameControl.invalid && nameControl.touched"
              id="name">
          </div>
        </div>
        <div class="form-group row">
          <div class="col-sm-12">
            <button type="submit" class="btn btn-sm btn-dark btn-block" [disabled]="!editCanvasDefinitionForm.valid">
              Update
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

</main>
